<span class="zsh-comment">#!/bin/bash</span>
<span class="zsh-comment"># Load the LaunchAgent which makes Octory re-appear when terminated by the user</span>

<span class="zsh-variable">loggedInUser</span><span class="zsh-keyword">=</span><span class="zsh-keyword">$</span><span class="zsh-punctuation">(</span> <span class="zsh-program">echo</span> <span class="zsh-string">"show State:/Users/ConsoleUser"</span> <span class="zsh-keyword">|</span> <span class="zsh-program">scutil</span> <span class="zsh-keyword">|</span> <span class="zsh-program">awk</span> <span class="zsh-string">'/Name :/ &amp;&amp; ! /loginwindow/ { print</span> <span class="zsh-variable">$3</span> <span class="zsh-string">}'</span> <span class="zsh-punctuation">)</span>
<span class="zsh-variable">loggedInUID</span><span class="zsh-keyword">=</span><span class="zsh-punctuation">`</span><span class="zsh-program">id</span> <span class="zsh-option-flag">-u</span> <span class="zsh-variable">${loggedInUser}</span><span class="zsh-punctuation">`</span>

<span class="zsh-keyword">if</span> <span class="zsh-punctuation">[</span><span class="zsh-punctuation">[</span> <span class="zsh-variable">${loggedInUID}</span> <span class="zsh-option-flag">-gt</span> <span class="zsh-command-option-value">500</span> <span class="zsh-punctuation">]</span><span class="zsh-punctuation">]</span><span class="zsh-punctuation">;</span> <span class="zsh-keyword">then</span>
    <span class="zsh-program">echo</span> <span class="zsh-string">"Launching Octory for user</span> <span class="zsh-variable">${loggedInUID}</span><span class="zsh-string">â€¦"</span>
    <span class="zsh-program">sudo</span> <span class="zsh-option-flag">-u</span> <span class="zsh-command-option-value">\#</span><span class="zsh-variable">${loggedInUID}</span> <span class="zsh-command-option-value">launchctl</span> <span class="zsh-command-option-value">enable</span> <span class="zsh-command-option-value">gui/</span><span class="zsh-variable">${loggedInUID}</span><span class="zsh-command-option-value">/com.amaris.octory.launch</span>
    <span class="zsh-program">sudo</span> <span class="zsh-option-flag">-u</span> <span class="zsh-command-option-value">\#</span><span class="zsh-variable">${loggedInUID}</span> <span class="zsh-command-option-value">launchctl</span> <span class="zsh-command-option-value">bootstrap</span> <span class="zsh-command-option-value">gui/</span><span class="zsh-variable">${loggedInUID}</span><span class="zsh-command-option-value">/</span> <span class="zsh-command-option-value">/Library/LaunchAgents/com.amaris.octory.launch.plist</span>
    <span class="zsh-program">sudo</span> <span class="zsh-option-flag">-u</span> <span class="zsh-command-option-value">\#</span><span class="zsh-variable">${loggedInUID}</span> <span class="zsh-command-option-value">launchctl</span> <span class="zsh-command-option-value">kickstart</span> <span class="zsh-command-option-value">gui/</span><span class="zsh-variable">${loggedInUID}</span><span class="zsh-command-option-value">/com.amaris.octory.launch</span>
<span class="zsh-keyword">fi</span>

<span class="zsh-program">cd</span> <span class="zsh-string">"/Library/Application Support/Octory/HelperInstall"</span>
<span class="zsh-program">./installHelper.sh</span>
